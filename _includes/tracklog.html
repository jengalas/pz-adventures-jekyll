<div class="map tracklog-map" id="tracklog-map"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/2.1.2/gpx.min.js"></script>
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
<script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>
<link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css" />
<script>
    var objBasemaps = {
        'OpenStreetMap': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }),
        'USGS Topo': L.tileLayer('https://caltopo.s3.amazonaws.com/topo/{z}/{x}/{y}.png', {
            attribution: 'USDA images from <a target="_blank" href="http://caltopo.com/">CalTopo</a>',
            maxZoom: 16,
            minZoom: 6
        }),
        'US National Map': L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }),
        'NatGeo': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC',
            maxZoom: 16
        }),
        'Imagery (Clarity)': L.tileLayer('https://clarity.maptiles.arcgis.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        })
    };


    var markMap = L.map('tracklog-map', { fullscreenControl: true, }).setView([44.5, -69], 15);
      
    objBasemaps['OpenStreetMap'].addTo(markMap); // Assign default basemap
    
    var objOverlays = {        
    };     

    var gpx = "https://tracklogs.planetzhanna.com/{{ page.tracklog }}";

    var ctlLayers = L.control.layers(objBasemaps, objOverlays).addTo(markMap);  
    
    L.control.polylineMeasure({unit: 'landmiles', showBearings: true}).addTo(markMap);

    const lyrGPX = new L.GPX(gpx, {
            async: true,
            markers: {
                wptIconUrls: {
                    '': '200px-Yellow_icon.svg.png',
                    'Flag, Blue': 'blue-flag-32.png'
                },   
                iconSize: [20, 20],
				iconAnchor: [0, 16],             
                startIcon: null,
                endIcon: null
                },
            polyline_options: {
                color: "red"
                }
            }).on('loaded', (e) => {
                markMap.fitBounds(e.target.getBounds());
                var track = e.target,
                distMi = track.get_distance_imp().toFixed(3);
                elGainFt = track.get_elevation_gain_imp().toFixed(0);
                elLossFt = track.get_elevation_loss_imp().toFixed(0);
                timeMoveMs = track.get_moving_time();
                 
            // create track details box
            const legend = L.control({ position: "bottomright" });

            legend.onAdd = function () {
                let div = L.DomUtil.create("div", "track-info");
                return div;
            };

            legend.addTo(markMap);

            let desc = document.querySelector(".track-info");

            desc.innerHTML = "<table><tbody><tr><th>Track Data</th></tr><tr><td><b>Total distance</b></td><td>" + distMi + " mi.</td></tr><tr><td><b>Elev. gain/loss</b></td><td> " + elGainFt +"'/" + elLossFt + "'</td></tr></tbody></table>";
          
            }).addTo(markMap);
            
    ctlLayers.addOverlay(lyrGPX,"GPX");
       
</script>